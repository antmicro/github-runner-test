on: [push]

name: test

jobs:
  simple-job:
    container: debian:bullseye
    runs-on: [self-hosted, Linux, X64]
    env:
      GHA_PREEMPTIBLE: "false"
    steps:
    - uses: actions/checkout@v2
      with:
          submodules: recursive
    - run: "apt -qqy update && apt -qqy --no-install-recommends install docker.io cgroupfs-mount crun fuse-overlayfs pigz ca-certificates" 
    - run: cgroupfs-mount
    - name: Run steps in Docker
      run: |
        dockerd -s fuse-overlayfs --add-runtime=crun=/usr/bin/crun --default-runtime=crun &
        sleep 30
        trap "kill $(cat /var/run/docker.pid)" EXIT
        docker run -t centos cat /etc/os-release
